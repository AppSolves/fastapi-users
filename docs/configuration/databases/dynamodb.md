# DynamoDB

**FastAPI Users** provides the necessary tools to work with DynamoDB NoSQL databases thanks to [aiopynamodb](https://github.com/AppSolves/AioPynamoDB).

## Asynchronous driver

Since `aiopynamodb` is a complete async port of [pynamodb](https://github.com/pynamodb/PynamoDB), we don't need any async drivers as everything is handled automatically.

Also, if you want to use **DynamoDB Local** instead of the AWS Cloud version, you can install it as follows:
```bash
$ wget --quiet http://dynamodb-local.s3-website-us-west-2.amazonaws.com/dynamodb_local_latest.tar.gz -O /tmp/dynamodb_local_latest.tar.gz
$ tar -xzf /tmp/dynamodb_local_latest.tar.gz -C /tmp
$ java -Djava.library.path=/tmp/DynamoDBLocal_lib -jar /tmp/DynamoDBLocal.jar -inMemory -port 8000 &
```

This will install and run DynamoDB locally in your RAM. It will automatically capture requests made by `aiobotocore`.
However, if you ARE using the cloud version, make sure to follow this [tutorial](https://www.youtube.com/watch?v=qURCbZGIsFs) (or any other) on how to create secure credentials for AWS.
Make sure to set the `AWS_ACCESS_KEY_ID` and `AWS_SECRET_ACCESS_KEY` environment variables or use the [AWS CLI](https://aws.amazon.com/cli) to configure access.

## Create the User model

As for any AioPynamoDB ORM model, we'll create a `User` model.

```py hl_lines="15-16"
--8<-- "docs/src/db_dynamodb.py"
```

As you can see, **FastAPI Users** provides a base class that will include base fields for our `User` table. You can of course add you own fields there to fit to your needs!

!!! tip "Primary key is defined as UUID"
    By default, we use UUID as a primary key ID for your user. If you want to use another type, like an auto-incremented integer, you can use `DynamoDBBaseUserTable` as base class and define your own `id` column.

    ```py
    class User(DynamoDBBaseUserTable[int], Base):
        id = NumberAttribute(hash_key=True, default=123)
    ```

    Notice that `DynamoDBBaseUserTable` expects a generic type to define the actual type of ID you use.

## Implement a function to create the tables

We'll now create an utility function to create all the defined tables.

```py hl_lines="23-25"
--8<-- "docs/src/db_dynamodb.py"
```

This function can be called, for example, during the initialization of your FastAPI app.

## Create the database adapter dependency

The database adapter of **FastAPI Users** makes the link between your database configuration and the users logic. It should be generated by a FastAPI dependency.

```py hl_lines="28-34"
--8<-- "docs/src/db_dynamodb.py"
```

We then use the `get_user_db` dependency to generate our adapter. Notice that we pass it the `User` class, which is the actual DynamoDB model.
